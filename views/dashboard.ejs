<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/styles/dashboard.css">
    <link rel="stylesheet" href="/styles/menyPanel.css">    
</head>

  <h1>Dashboard</h1>

<body>
    <%- include ('partials/menyPanel') %>   
    
    <main class="dashboard-innhold">
        <!-- Øverste rad med summer -->
        <section class="samletVerdiBoks">
          <div class="samletVerdi">
            <h3>Samlet verdi</h3>
            <p id="samletVerdi"></p>
          </div>
          <div class="realisertGevinstBoks">
            <h3>Total Realisert gevinst</h3>
            <p id="realisertGevinst"></p>
          </div>
          <div class="urealisertGevinstBoks">
            <h3>Total Urealisert gevinst</h3>
            <p id="urealisertGevinst"></p>
          </div>
        </section>
    
        <!-- Verdiutvikling -->
        <section class="verdiutvikling">
          <h3>Samlet verdiutvikling</h3>
          <div class="graf-placeholder">[Graf kommer her]</div>
        </section>
    
        <!-- Aksjetabeller -->
        <section class="aksjetabeller">
          <div class="aksjetabell">
            <h3>Topp 5 aksjer etter verdi</h3>
            <table>
              <thead>
                <tr><th>Navn</th><th>Portefølje</th><th>24t Endring</th><th>Verdi</th></tr>
              </thead>
              <tbody id="aksjerVerdi"></tbody>
            </table>
          </div>
    
          <div class="aksjetabell">
            <h3>Topp 5 aksjer etter gevinst</h3>
            <table>
              <thead>
                <tr><th>Navn</th><th>Portefølje</th><th>24t Endring</th><th>Verdi</th></tr>
              </thead>
              <tbody id="aksjerGevinst"></tbody>
            </table>
          </div>
        </section>
      </main>
    <script>
      fetch('/api/verdiutvikling')
        .then(response => response.json())
        .then(data => {
          const labels = data.samletVerdi;
          const verdier = data.verdiutvikling;

          const ctx = document.getElementById('verdiGraf').getContext('2d');

          const chartData = {
            labels: labels,
            datasets: [{
              label: 'Verdiutvikling',
              data: verdier,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderWidth: 1
            }]
          };

          const config = {
            type: 'line',
            data: data,
          }
        });
        
        const brukernavn = localStorage.getItem('brukernavn');

        fetch(`/samlet-verdi/${brukernavn}`)
          .then(res => res.json())
          .then(data => {
            const sVerdi = document.getElementById('samletVerdi');

            if(data.length === 0){
              sVerdi.textContent = '0';
            }
            else{
              sVerdi.innerHTML = data.map(item => {
                const verdi = Number(item.samletVerdi).toFixed(2);
                return `${verdi} ${item.valuta}`;
            }).join('<br>');
            }
          })
          .catch(error => console.error('Feil ved henting av samlet verdi', error));


  

    </script>
</body>
</html>